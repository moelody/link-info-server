"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("hexo-fs"),t=require("path");function n(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var r=n(e),i=n(t);
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function o(e,t,n,r){return new(n||(n=Promise))((function(i,o){function l(e){try{a(r.next(e))}catch(e){o(e)}}function c(e){try{a(r.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,c)}a((r=r.apply(e,t||[])).next())}))}const l=(e,t)=>o(void 0,void 0,void 0,(function*(){let n=e,r=yield v(t),i=r.filter((e=>"wiki"===e.type));for(let e of i){let r=c("markdown",e.linkText,e.altOrBlockRef,t);n=n.replace(e.match,r)}let o=r.filter((e=>"wikiTransclusion"===e.type));for(let e of o){let r=c("mdTransclusion",e.linkText,e.altOrBlockRef,t);n=n.replace(e.match,r)}return n})),c=(e,t,n,r)=>{let o,l=t,c=decodeURI(l),a={basename:i.basename(r.source)};return l=function(e,t){function n(e){let t=0;for(;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}for(var r=n(e.split("/")),i=n(t.split("/")),o=Math.min(r.length,i.length),l=o,c=0;c<o;c++)if(r[c]!==i[c]){l=c;break}var a=[];for(c=l;c<r.length-1;c++)a.push("..");return(a=a.concat(i.slice(l))).join("/")}(r.path,c),"wiki"===e?(o=""!==n&&n!==decodeURI(l)?a&&decodeURI(n)===a.basename?"":"|"+n:"",`[[${decodeURI(l)}${o}]]`):"markdown"===e?(o=""!==n?n:a?a.basename:l,`[${o}](${encodeURI(l)})`):void 0};const a=/\[\[(.*?)#.*?\]\]/,u=/(?<=\[\[)(.*)(?=#)/,f=/(?<=#).*?(?=]])/,s=/\[.*?]\((.*?)#.*?\)/,h=/(?<=\]\()(.*)(?=#)/,d=/(?<=#).*?(?=\))/,p=e=>s.test(e),k=e=>{let t=a.test(e),n=s.test(e);if(t||n){let n=e.match(t?u:h);if(n)return n[0]}return""},m=e=>{let t=a.test(e),n=s.test(e);if(t||n){let n=e.match(t?f:d);if(n)return n[0]}return""},v=e=>o(void 0,void 0,void 0,(function*(){const t=[];let n=r.readFileSync(e.source),i=n.match(/\[\[.*?\]\]/g);if(i){let n=/(?<=\[\[).*?(?=(\]|\|))/,r=/(?<=\|).*(?=]])/;for(let l of i){if(o=l,a.test(o)){let n=k(l),r=m(l);if(""!==n&&""!==r){let i={type:"wikiTransclusion",match:l,linkText:n,altOrBlockRef:r,sourceFilePath:e.path};t.push(i);continue}}let i=l.match(n);if(i){if(i[0].startsWith("http"))continue;let n=l.match(r),o={type:"wiki",match:l,linkText:i[0],altOrBlockRef:n?n[0]:"",sourceFilePath:e.path};t.push(o)}}}var o;let l=n.match(/\[(^$|.*?)\]\((.*?)\)/g);if(l){let n=/(?<=\().*(?=\))/,r=/(?<=\[)(^$|.*?)(?=\])/;for(let i of l){if(p(i)){let n=k(i),r=m(i);if(""!==n&&""!==r){let o={type:"mdTransclusion",match:i,linkText:n,altOrBlockRef:r,sourceFilePath:e.path};t.push(o);continue}}let o=i.match(n);if(o){if(o[0].startsWith("http"))continue;let n=i.match(r),l={type:"markdown",match:i,linkText:o[0],altOrBlockRef:n?n[0]:"",sourceFilePath:e.path};t.push(l)}}}return t}));exports.convertLinksAndSaveInSingleFile=e=>o(void 0,void 0,void 0,(function*(){let t=r.readFileSync(e.source),n=yield l(t,e);yield r.writeFile(e.source,n)})),exports.convertWikiLinksToMarkdown=l;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udmVydGVyLmpzIiwic291cmNlcyI6WyJzcmMvY29udmVydGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpudWxsLCJuYW1lcyI6WyJjb252ZXJ0V2lraUxpbmtzVG9NYXJrZG93biIsIm1kIiwic291cmNlRmlsZSIsIm5ld01kVGV4dCIsImxpbmtNYXRjaGVzIiwiZ2V0QWxsTGlua01hdGNoZXNJbkZpbGUiLCJ3aWtpTWF0Y2hlcyIsImZpbHRlciIsIm1hdGNoIiwidHlwZSIsIndpa2lNYXRjaCIsIm1kTGluayIsImNyZWF0ZUxpbmsiLCJsaW5rVGV4dCIsImFsdE9yQmxvY2tSZWYiLCJyZXBsYWNlIiwid2lraVRyYW5zY2x1c2lvbnMiLCJ3aWtpVHJhbnNjbHVzaW9uIiwid2lraVRyYW5zY2x1c2lvbkxpbmsiLCJkZXN0Iiwib3JpZ2luYWxMaW5rIiwiYWx0VGV4dCIsImZpbmFsTGluayIsImZpbGVMaW5rIiwiZGVjb2RlVVJJIiwiZmlsZSIsImJhc2VuYW1lIiwicGF0aCIsInNvdXJjZSIsInNvdXJjZUZpbGVQYXRoIiwibGlua2VkRmlsZVBhdGgiLCJ0cmltIiwiYXJyIiwic3RhcnQiLCJsZW5ndGgiLCJlbmQiLCJzbGljZSIsImZyb21QYXJ0cyIsInNwbGl0IiwidG9QYXJ0cyIsIk1hdGgiLCJtaW4iLCJzYW1lUGFydHNMZW5ndGgiLCJpIiwib3V0cHV0UGFydHMiLCJwdXNoIiwiY29uY2F0Iiwiam9pbiIsImdldFJlbGF0aXZlTGluayIsImVuY29kZVVSSSIsIndpa2lUcmFuc2NsdXNpb25SZWdleCIsIndpa2lUcmFuc2NsdXNpb25GaWxlTmFtZVJlZ2V4Iiwid2lraVRyYW5zY2x1c2lvbkJsb2NrUmVmIiwibWRUcmFuc2NsdXNpb25SZWdleCIsIm1kVHJhbnNjbHVzaW9uRmlsZU5hbWVSZWdleCIsIm1kVHJhbnNjbHVzaW9uQmxvY2tSZWYiLCJtYXRjaElzTWRUcmFuc2NsdXNpb24iLCJ0ZXN0IiwiZ2V0VHJhbnNjbHVzaW9uRmlsZU5hbWUiLCJpc1dpa2kiLCJpc01kIiwiZmlsZU5hbWVNYXRjaCIsImdldFRyYW5zY2x1c2lvbkJsb2NrUmVmIiwiYmxvY2tSZWZNYXRjaCIsIm1kRmlsZSIsImZpbGVUZXh0IiwiZnMiLCJyZWFkRmlsZVN5bmMiLCJmaWxlUmVnZXgiLCJhbHRSZWdleCIsImZpbGVOYW1lIiwibGlua01hdGNoIiwiZmlsZU1hdGNoIiwic3RhcnRzV2l0aCIsImFsdE1hdGNoIiwibWFya2Rvd25NYXRjaGVzIiwibWFya2Rvd25NYXRjaCIsIm5ld0ZpbGVUZXh0Iiwid3JpdGVGaWxlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7MlNBMEJhQSxFQUE2QixDQUFPQyxFQUFZQyx3Q0FDekQsSUFBSUMsRUFBWUYsRUFDWkcsUUFBaUNDLEVBQXdCSCxHQUV6REksRUFBY0YsRUFBWUcsUUFBUUMsR0FBeUIsU0FBZkEsRUFBTUMsT0FDdEQsSUFBSyxJQUFJQyxLQUFhSixFQUFhLENBQy9CLElBQUlLLEVBQVNDLEVBQVcsV0FBWUYsRUFBVUcsU0FBVUgsRUFBVUksY0FBZVosR0FDakZDLEVBQVlBLEVBQVVZLFFBQVFMLEVBQVVGLE1BQU9HLEdBR25ELElBQUlLLEVBQW9CWixFQUFZRyxRQUFRQyxHQUF5QixxQkFBZkEsRUFBTUMsT0FDNUQsSUFBSyxJQUFJUSxLQUFvQkQsRUFBbUIsQ0FDNUMsSUFBSUUsRUFBdUJOLEVBQVcsaUJBQWtCSyxFQUFpQkosU0FBVUksRUFBaUJILGNBQWVaLEdBQ25IQyxFQUFZQSxFQUFVWSxRQUFRRSxFQUFpQlQsTUFBT1UsR0FFMUQsT0FBT2YsS0FLTFMsRUFBYSxDQUFDTyxFQUFnQkMsRUFBc0JOLEVBQXVCWixLQUM3RSxJQUNJbUIsRUFEQUMsRUFBWUYsRUFHWkcsRUFBV0MsVUFBVUYsR0FDckJHLEVBQU8sQ0FBRUMsU0FBVUMsRUFBS0QsU0FBaUJ4QixFQUFXMEIsU0FHeEQsT0FGQU4sRUErQkosU0FBeUJPLEVBQXdCQyxHQUM3QyxTQUFTQyxFQUFLQyxHQUNWLElBQUlDLEVBQVEsRUFDWixLQUFPQSxFQUFR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
